This is based off: https://github.com/jorjic/gmtemplate